<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Society Maintenance Tracker</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; max-width: 800px; }
    input, button { margin: 5px; padding: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1>üè† Housing Society FFinance</h1>

<div id="login">
  <h3>Admin Login</h3>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="app" class="hidden">
  <button onclick="logout()">Logout</button>

  <h2>üí∞ Add Maintenance</h2>
  <input type="date" id="income-date">
  <input type="text" id="income-name" placeholder="Member Name">
  <input type="number" id="income-amount" placeholder="Amount">
  <button onclick="addIncome()">Save Income</button>

  <h2>üí∏ Add Expense</h2>
  <input type="date" id="expense-date">
  <input type="text" id="expense-category" placeholder="Category">
  <input type="number" id="expense-amount" placeholder="Amount">
  <input type="text" id="expense-desc" placeholder="Description">
  <button onclick="addExpense()">Save Expense</button>

  <h2>üìÖ Filter by Month</h2>
  <input type="month" id="filter-month" onchange="render()">

  <h3>Summary</h3>
  <p>Total Income: ‚Çπ<span id="sum-income">0</span></p>
  <p>Total Expenses: ‚Çπ<span id="sum-expense">0</span></p>
  <p><strong>Balance: ‚Çπ<span id="balance">0</span></strong></p>

  <h3>Income Records</h3>
  <table>
    <thead><tr><th>Date</th><th>Name</th><th>Amount</th></tr></thead>
    <tbody id="income-table"></tbody>
  </table>

  <h3>Expense Records</h3>
  <table>
    <thead><tr><th>Date</th><th>Category</th><th>Amount</th><th>Description</th></tr></thead>
    <tbody id="expense-table"></tbody>
  </table>

  <h3>üì§ Export</h3>
  <button onclick="exportPDF()">Download PDF Report</button>
</div>

<script>
  // ‚úÖ Paste your Firebase config here:
 // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAqJyfDCDV8mxznEbalSOq1lsDVbYYEj0o",
  authDomain: "androidkattappa.firebaseapp.com",
  projectId: "androidkattappa",
  storageBucket: "androidkattappa.firebasestorage.app",
  messagingSenderId: "988593122249",
  appId: "1:988593122249:web:473ffb8fc6628b31375618",
  measurementId: "G-RB3XQGKWNY"
};
    
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(user => {
    document.getElementById('login').classList.toggle('hidden', !!user);
    document.getElementById('app').classList.toggle('hidden', !user);
    if (user) loadData();
  });

  function login() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
  }

  function logout() {
    auth.signOut();
  }

  function addIncome() {
    const data = {
      type: 'income',
      date: document.getElementById("income-date").value,
      name: document.getElementById("income-name").value,
      amount: parseFloat(document.getElementById("income-amount").value)
    };
    db.collection("transactions").add(data).then(render);
  }

  function addExpense() {
    const data = {
      type: 'expense',
      date: document.getElementById("expense-date").value,
      category: document.getElementById("expense-category").value,
      amount: parseFloat(document.getElementById("expense-amount").value),
      desc: document.getElementById("expense-desc").value
    };
    db.collection("transactions").add(data).then(render);
  }

  async function loadData() {
    const snapshot = await db.collection("transactions").get();
    window.transactions = snapshot.docs.map(doc => doc.data());
    render();
  }

  function render() {
    const month = document.getElementById("filter-month").value;
    const incT = document.getElementById("income-table");
    const expT = document.getElementById("expense-table");
    incT.innerHTML = "";
    expT.innerHTML = "";

    const data = window.transactions || [];

    let income = 0, expense = 0;
    data.forEach(t => {
      if (month && !t.date.startsWith(month)) return;
      if (t.type === "income") {
        incT.innerHTML += `<tr><td>${t.date}</td><td>${t.name}</td><td>‚Çπ${t.amount}</td></tr>`;
        income += t.amount;
      } else {
        expT.innerHTML += `<tr><td>${t.date}</td><td>${t.category}</td><td>‚Çπ${t.amount}</td><td>${t.desc}</td></tr>`;
        expense += t.amount;
      }
    });

    document.getElementById("sum-income").textContent = income.toFixed(2);
    document.getElementById("sum-expense").textContent = expense.toFixed(2);
    document.getElementById("balance").textContent = (income - expense).toFixed(2);
  }

  function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const data = window.transactions || [];
    const rows = data.map(t => [
      t.date,
      t.type,
      t.name || t.category,
      `‚Çπ${t.amount}`,
      t.desc || ""
    ]);

    doc.setFontSize(14);
    doc.text("Society Finance Report", 14, 20);
    doc.autoTable({
      head: [["Date", "Type", "Name/Category", "Amount", "Description"]],
      body: rows,
      startY: 30
    });

    doc.save("finance_report.pdf");
  }
</script>
</body>
</html>
